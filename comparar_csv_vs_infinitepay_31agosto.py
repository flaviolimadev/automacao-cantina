#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Script para comparar respons√°veis do CSV com relat√≥rio Infinite Pay
Identifica quais respons√°veis do CSV n√£o est√£o no relat√≥rio
"""

import csv
import re

def extrair_nomes_infinitepay(texto):
    """Extrai nomes do relat√≥rio Infinite Pay"""
    nomes = set()
    
    # Padr√£o para encontrar nomes no relat√≥rio
    # Formato: NOME VIA AUTOMA√áAO + VALOR
    padrao = r'([A-Z√Ä√Å√Ç√É√Ñ√Ö√Ü√á√à√â√ä√ã√å√ç√é√è√ê√ë√í√ì√î√ï√ñ√ò√ô√ö√õ√ú√ù√û≈∏][A-Z√Ä√Å√Ç√É√Ñ√Ö√Ü√á√à√â√ä√ã√å√ç√é√è√ê√ë√í√ì√î√ï√ñ√ò√ô√ö√õ√ú√ù√û≈∏\s]+?)\s+VIA AUTOMA√áAO'
    
    matches = re.findall(padrao, texto)
    for match in matches:
        nome = match.strip()
        if nome and len(nome) > 3:  # Nome deve ter pelo menos 3 caracteres
            nomes.add(nome)
    
    return nomes

def normalizar_nome(nome):
    """Normaliza nome para compara√ß√£o"""
    # Converter para mai√∫sculas e remover espa√ßos extras
    return ' '.join(nome.upper().split())

def main():
    print("üîç COMPARANDO CSV vs RELAT√ìRIO INFINITE PAY")
    print("=" * 60)
    
    # Arquivo CSV
    csv_file = "responsaveis_com_dividas_20250824_131824.csv"
    
    # Relat√≥rio Infinite Pay (31 de agosto)
    relatorio_infinitepay = """
VANESSA GOSSON GADELHA DE FREITAS FORTES + 78,00
ALINE MANETTI LOPES BARANSKI VIA AUTOMA√áAO + 6,00
GIULLIANE ROCHA BOTARELI DANTAS VIA AUTOMA√áAO + 6,00
SUELY ALESSANDRA DA SILVA ALVES VIA AUTOMA√áAO + 6,00
CLEBER PEDRO DE OLIVEIRA VIA AUTOMA√áAO + 6,00
LUCAS RAMATIS VIA AUTOMA√áAO + 6,00
SOUSA BERENICE DE CARVALHO VIA AUTOMA√áAO + 14,00
VERANA SIM√ÉO DE HOLANDA MOURA VIA AUTOMA√áAO + 6,00
ANA LUIZA DOS SANTOS CRUZ VIA AUTOMA√áAO + 9,00
ROSINARA DA SILVA BORGES SANTANA VIA AUTOMA√áAO + 9,00
JESSICA KAROLINE CAMPOS COSTA VIA AUTOMA√áAO + 18,00
JAZIA AMARILES DA SILVA OLIVEIRA VIA AUTOMA√áAO + 16,00
ASENATE DAMARIS CAETANO DA ROCHA VIA AUTOMA√áAO + 8,00
CHRISTIELLE DE LIMA CONRADO VIA AUTOMA√áAO + 6,00
MARIA DE FATIMA DA SILVA FARIAS SOARES VIA AUTOMA√áAO + 6,00
MARCIA TALITA VIA AUTOMA√áAO + 10,00
HAGAR MARIA DE ANDRADE PINHEIRO VIA AUTOMA√áAO + 19,00
MARCOS SANT'ANNA DA SILVA JUNIOR VIA AUTOMA√áAO + 10,00
MARIA MARILENE DE OLIVEIRA VIA AUTOMA√áAO + 32,00
MARIANGELA MOTA DE OLIVEIRA NUNES VIA AUTOMA√áAO + 6,00
MARILIA DE MOURA CAF√â FREIRE VIA AUTOMA√áAO + 8,00
LUCIANA MONTEIRO MARQUES VIA AUTOMA√áAO + 74,00
ANA CLEIDE DE AGUIAR FERREIRA VIA AUTOMA√áAO + 11,00
CASSIA CASTILHO MAROTTI VIA AUTOMA√áAO + 64,00
CARLA PAVONE SANTISTEBAN VIA AUTOMA√áAO + 72,00
MARCOS AURELIO PEREIRA DE AZEVEDO VIA AUTOMA√áAO + 42,00
FLAVIA DE OLIVEIRA GOMES DE ARA√öJO VIA AUTOMA√áAO + 5,00
MARIA DE F√ÅTIMA DA SILVA LIMA VIA AUTOMA√áAO + 10,00
JANA√çNA CORDULA DO LAGO VIA AUTOMA√áAO + 12,00
ELIANDERSON OLIVEIRA DOS SANTOS VIA AUTOMA√áAO + 8,00
CARLA SONEIDE DA SILVA OLIVEIRA BATISTA VIA AUTOMA√áAO + 24,00
JANAINA ATALIBA DE MELO SOUZA VIA AUTOMA√áAO + 23,00
ALEXANDRA LIMA BEZERRA VIA AUTOMA√áAO + 21,00
ADRIANA SANTOS LE√îNCIO BRAND√ÉO VIA AUTOMA√áAO + 11,00
JAMILE MARQUES BARROS DA SILVA VIA AUTOMA√áAO + 5,00
PAULA LILIANE MEDEIROS DA CONCEI√á√ÉO VIA AUTOMA√áAO + 50,00
MARIA JOSENY VIA AUTOMA√áAO + 11,00
ADRIANO ELISMAEL MAC√äDO DE PAIVA VIA AUTOMA√áAO + 38,00
MARIANA SILVA VIA AUTOMA√áAO + 47,00
MARCOS DELGADO DA SILVA VIA AUTOMA√áAO + 28,00
ELIZANDRO HEBERT RENOVATO DE MIRANDA VIA AUTOMA√áAO + 23,00
DIUANA NUNES DA SILVA VIA AUTOMA√áAO + 44,00
AURICEA MARIA DE MEDEIROS VIA AUTOMA√áAO + 11,00
IRANIR RIBEIRO DA SILVA BATISTA VIA AUTOMA√áAO + 56,00
ELIANE DA SILVA RODRIGUES VIA AUTOMA√áAO + 6,00
ERIKACIA DA SILVA BATISTA DOURADO VIA AUTOMA√áAO + 6,00
ALDENISE RAMOS CARNEIRO DA CUNHA VIA AUTOMA√áAO + 14,00
ROBERTA MONTEIRO DE SOUZA VIEIRA VIA AUTOMA√áAO + 10,00
KATIA ALVES MALHEIROS VIA AUTOMA√áAO + 12,00
MARIA KALINA MAIA DE OLIVEIRA VIA AUTOMA√áAO + 10,00
PATRICIA LOPES DA SILVA VIA AUTOMA√áAO + 19,00
SAMARA LOPES DE QUEIROZ VIA AUTOMA√áAO + 20,00
JOAO FRANCISCO DE SOUZA NETO VIA AUTOMA√áAO + 25,00
LISANDRA ALMEIDA DE OLIVEIRA VIA AUTOMA√áAO + 6,00
KARLA DANIELLA VIEIRA E SILVA ARAUJO VIA AUTOMA√áAO + 10,00
RAIZA CRISTINA PRAXEDES DA SILVA VIA AUTOMA√áAO + 6,00
MARTA DE HOLLANDA FRANCO ALBUQUERQUE VIA AUTOMA√áAO + 12,00
YARA ANGELICA ALVES FERNANDES VIA AUTOMA√áAO + 6,00
RAYANE PONTES VIA AUTOMA√áAO + 20,00
MIRI√É KELLY CHAGAS DO NASCIMENTO OLIVEIRA VIA AUTOMA√áAO + 6,00
JAQUELINE GOMES GOMES DA SILVA VIA AUTOMA√áAO + 27,00
FABIANA FREIRE RODRIGUES DE MEDEIROS VIA AUTOMA√áAO + 6,00
ARQUIMEDES JOSE EPIFANIO DA SILVA VIA AUTOMA√áAO + 13,00
GENIFFER LIMA DE BRITO MELO VIA AUTOMA√áAO + 41,00
HELENA LEITE DA SILVA ALENCAR VIA AUTOMA√áAO + 28,00
FERNANDA CRISTINA DA SILVA MEDEIROS VIA AUTOMA√áAO + 41,00
MARCOS SANT'ANNA DA SILVA JUNIOR VIA AUTOMA√áAO + 10,00
MARIANA LIMA DE PAIVA PERRUCI VIA AUTOMA√áAO + 6,00
PATRICIA DA SILVA ROCHA VIA AUTOMA√áAO + 27,00
PONCIO PABLO BERTOLDO DA COSTA VIA AUTOMA√áAO + 10,00
GUSTAVO RAPOSO VIA AUTOMA√áAO + 12,00
FLAVIANA BEZERRA LEAO FONSECA VIA AUTOMA√áAO + 41,00
SUERDA MEDEIROS DE SOUZA SANTOS VIA AUTOMA√áAO + 73,00
KRISTIANE GLACIENE NUNES FILGUEIRA CAMARA VIA AUTOMA√áAO + 29,00
PAULO CESAR DE LIMA VIA AUTOMA√áAO + 43,00
TASSIA CAMILA DA SILVA VIA AUTOMA√áAO + 16,00
CRISTIANNE MARCELLE MEDEIROS DOS SANTOS MELO VIA AUTOMA√áAO + 11,00
ROBEILTON AZEVEDO DA SILVA GOMES VIA AUTOMA√áAO + 30,00
JUCIARA MARIA SILVA DO NASCIMENTO VIA AUTOMA√áAO + 26,00
MICARLA GOMES DE PONTES VIA AUTOMA√áAO + 38,00
JULLIETE GON√áALVES DE OLIVEIRA PIMENTA VIA AUTOMA√áAO + 15,00
CLAUDIANA MARIA DE OLIVEIRA MARTINS VIA AUTOMA√áAO + 20,00
KEYLANE MARQUES DA SILVA RAMOS VIA AUTOMA√áAO + 8,00
ANDREZA CARVALHO DE LIMA TELLES VIA AUTOMA√áAO + 6,00
VANIA CLEIDE DE MORAIS SILVA LIRA VIA AUTOMA√áAO + 62,00
MONICA PATRICIA LINHARES VIA AUTOMA√áAO + 20,00
DAYANNY DUARTE DE MOURA FERREIRA VIA AUTOMA√áAO + 24,00
SUZETE LOPES GALV√ÉO VIA AUTOMA√áAO + 12,00
PATRICIA TORRES VIA AUTOMA√áAO + 40,00
AMANDA AMANDA VIA AUTOMA√áAO + 10,00
TALIANE SUERDA DE MORA SILVA VIA AUTOMA√áAO + 46,00
JOSEFA JEOVANIA TEIXEIRA DE OLIVEIRA DIAS VIA AUTOMA√áAO + 10,00
SAMUEL SOUZA VIA AUTOMA√áAO + 21,00
MAGNOLIA FAGUNDES ALVES BARBOSA VIA AUTOMA√áAO + 28,00
PAULO RANGEL VIA AUTOMA√áAO + 51,00
ALESSANDRA BELLAGUARDA VIA AUTOMA√áAO + 76,00
ANDR√âA KALINE COSTA DA SILVA VIA AUTOMA√áAO + 10,00
KELLYANE CRISTINE PRATA DE LUCENA RIBEIRO VIA AUTOMA√áAO + 9,00
TASSIA LOURENA DE OLIVEIRA ARAUJO DANTAS VIA AUTOMA√áAO + 4,00
AMANDA DANTAS CAD√ì VIA AUTOMA√áAO + 11,00
MARIA ISABEL RAMALHO GONCALVES VIA AUTOMA√áAO + 23,00
ANDREZA CABRAL C√ÇMARA NUNES VIA AUTOMA√áAO + 25,00
DI√ìGENES PEREIRA DA SILVA VIA AUTOMA√áAO + 28,00
ANA RAPHAELLA BARROCA FRANCO VIA AUTOMA√áAO + 14,00
GLADYS NUNES VIEIRA VIA AUTOMA√áAO + 13,00
ANA CYNTHIA PRAXEDES DE AMORIM E SILVA ALMEIDA VIA AUTOMA√áAO + 4,00
ELAINNE VANESSA DE ANDRADE CLEMENTINO VIA AUTOMA√áAO + 20,00
FELIPE LANDEIRA VIA AUTOMA√áAO + 13,00
ANA SANTANA DE ARA√öJO VIA AUTOMA√áAO + 17,00
JULIETE SANTOS VIA AUTOMA√áAO + 16,00
DANIELLY CRISTINA BEZERRA DE SOUZA ALMEIDA VIA AUTOMA√áAO + 99,00
MARIA IVANILDA BERNADINO DA SILVA SEGUNDO VIA AUTOMA√áAO + 40,00
DANIELE DUARTE MENDON√áA BARBOSA VIA AUTOMA√áAO + 33,00
FRANCIDALVA PEDRO DOS SANTOS VIA AUTOMA√áAO + 37,00
LUCAS GABRIEL NUNES DOS SANTOS S√âTIMO B VIA AUTOMA√áAO + 18,00
KRYSSIA ALEIXO DE SOUZA CAROLINO DE MELO VIA AUTOMA√áAO + 71,00
MIKAELY LISIANE DIAS DE AQUINO OLIVEIRA VIA AUTOMA√áAO + 37,00
FERNANDA EDIKA DE SOUZA LOPES VIA AUTOMA√áAO + 41,00
EDUARDO LIMA DE SANTANA VIA AUTOMA√áAO + 40,00
ANDRE MARCOS DA CUNHA VARELA VIA AUTOMA√áAO + 38,00
REBECA DA ROCHA MARQUES LOPES VIA AUTOMA√áAO + 30,00
FLAVIA SILVA DE MACEDO VIA AUTOMA√áAO + 5,00
NILMA CRISTINA VIA AUTOMA√áAO + 122,00
ISABELLY THUANY DE FREITAS CARVALHO VIA AUTOMA√áAO + 34,00
LAYANE ORRICO VIA AUTOMA√áAO + 11,00
MARIA SELMA INACIO DE OLIVEIRA VIA AUTOMA√áAO + 32,00
BETANIA SILVA DE ARAUJO MEDEIROS VIA AUTOMA√áAO + 45,00
LICIA DE CASTRO REGO VIA AUTOMA√áAO + 42,00
ERIKA HERONILDES COSTA DA SILVA VIA AUTOMA√áAO + 28,00
MACLI IRVING DA SILVA VIA AUTOMA√áAO + 72,00
NAIRA CAROLINE DE OLIVEIRA BRITO VIA AUTOMA√áAO + 37,00
ELIANA CARLA GOMES DE ALBUQUERQUE MONTEIRO VIA AUTOMA√áAO + 11,00
SARAH SASKYA SERAFIM DE ARA√öJO VIA AUTOMA√áAO + 18,00
ANDREZA KARINA ALVES PAIVA DUARTE VIA AUTOMA√áAO + 11,00
KALINE RODRIGUES DE FREITAS PAIVA VIA AUTOMA√áAO + 6,00
FERNANDA THEMES SILVA NASCIMENTO FERNANDES VIA AUTOMA√áAO + 24,00
EMILVA DANTAS DA SILVA MENDON√áA VIA AUTOMA√áAO + 23,00
ROBERTO ALVES DA SILVA VIA AUTOMA√áAO + 11,00
EDIONE MENDON√áA MACARIO VIA AUTOMA√áAO + 73,00
MARIA EDUARDA DANTAS TAVARES DA SILVA VIA AUTOMA√áAO + 42,00
SARA RUANA VIA AUTOMA√áAO + 41,00
NATHALLYA KARELLYNE INACIO DUARTE DE MELO OLIVEIRA VIA AUTOMA√áAO + 33,00
MARIA MICARLA DE FREITAS VIA AUTOMA√áAO + 45,00
VIVIANE ARNAUD LOPES DIAS VIA AUTOMA√áAO + 34,00
JOELMA MATIAS VIA AUTOMA√áAO + 29,00
ERIKA PRISCILLA VIA AUTOMA√áAO + 129,00
L√öCIO CARLOS DE OLIVEIRA BARBOSA VIA AUTOMA√áAO + 96,00
LIGIA ANDERSON DA SILVA COSTA ARAUJO VIA AUTOMA√áAO + 33,00
NEUSSANA KELLEN DE ARAUJO MEDEIROS TORRE√ÉO VIA AUTOMA√áAO + 24,00
ANA CAROLINA MAIA DE S√Å VIA AUTOMA√áAO + 33,00
TATIANA DE CARVALHO MACHADO VIA AUTOMA√áAO + 33,00
TALITTA SANTOS NEVES VIA AUTOMA√áAO + 39,00
AGOSTINHO JUSTINO DE ANDRADE NETO VIA AUTOMA√áAO + 18,00
G√äUZILENE EMANUEL LE CRUZ DE FRAN√áA DAS CHAGAS VIA AUTOMA√áAO + 20,00
DANIELE ROSEGLEI DA SILVA VIA AUTOMA√áAO + 16,00
ANDREZZA SIMOES DA SILVA VIA AUTOMA√áAO + 29,00
JULIENE ANGELICA RODRIGUES MASCARENHAS MOURA VIA AUTOMA√áAO + 35,00
JAQUELINE WANDERLEI VIA AUTOMA√áAO + 31,00
CIBELE DE CASTRO REGO HERONILDES VIA AUTOMA√áAO + 39,00
O'HARA DANIELE SOARES COUTINHO VIA AUTOMA√áAO + 9,00
KAYNIELLE VANELE VIA AUTOMA√áAO + 23,00
ANA PAULA VIA AUTOMA√áAO + 36,00
MISSERINE DEL VALLE CARVAJAL VICUNA VIA AUTOMA√áAO + 76,00
CHARLENE GABRIEL SOARES DE MELO VIA AUTOMA√áAO + 78,00
RODRIGO REGLY CARVALHO VIA AUTOMA√áAO + 47,00
MARUSK MIKAELLY ALVES DE LIMA VIA AUTOMA√áAO + 29,00
JANE KELLY DOS SANTOS CANINDE GOMES VIA AUTOMA√áAO + 32,00
ELIONORA BATISTA DOS SANTOS VIA AUTOMA√áAO + 61,00
JACQUELINE EVANGELISTA DE SOUSA VIA AUTOMA√áAO + 109,00
ANA CAROLINA NOVAES FERNANDES VIA AUTOMA√áAO + 99,00
JACIANE FERREIRA DE LIMA VIDAL VIA AUTOMA√áAO + 41,00
BETANIA CARDOSO VIA AUTOMA√áAO + 71,00
LIDNADJA CRISTINA SILVEIRA DE SOUZA VIA AUTOMA√áAO + 20,00
DAYSE SOARES DOS SANTOS VIA AUTOMA√áAO + 34,00
THIAGO MARTINS DE SOUZA VIA AUTOMA√áAO + 26,00
MARCUS VINICIUS DOS SANTOS COSTA AQUINO VIA AUTOMA√áAO + 12,00
KATIA PATRICIA DE OLIVEIRA AQUINO VIA AUTOMA√áAO + 40,00
GABRIELA ARAUJO SARAIVA NERY VIA AUTOMA√áAO + 24,00
YANNE BARRETO VIA AUTOMA√áAO + 119,00
LIDIANE DE LIMA SILVA VIDIGAL + 10,00
    """
    
    # Extrair nomes do relat√≥rio Infinite Pay
    print("üìä Extraindo nomes do relat√≥rio Infinite Pay...")
    nomes_infinitepay = extrair_nomes_infinitepay(relatorio_infinitepay)
    print(f"‚úÖ {len(nomes_infinitepay)} nomes extra√≠dos do relat√≥rio")
    
    # Ler nomes do CSV
    print(f"üìã Lendo nomes do CSV: {csv_file}")
    nomes_csv = set()
    try:
        with open(csv_file, 'r', encoding='utf-8') as arquivo:
            leitor = csv.DictReader(arquivo)
            for linha in leitor:
                nome = linha['Nome'].strip()
                if nome:
                    nomes_csv.add(nome)
        print(f"‚úÖ {len(nomes_csv)} nomes lidos do CSV")
    except FileNotFoundError:
        print(f"‚ùå Arquivo {csv_file} n√£o encontrado!")
        return
    except Exception as e:
        print(f"‚ùå Erro ao ler CSV: {str(e)}")
        return
    
    # Normalizar nomes para compara√ß√£o
    nomes_infinitepay_norm = {normalizar_nome(nome) for nome in nomes_infinitepay}
    nomes_csv_norm = {normalizar_nome(nome) for nome in nomes_csv}
    
    # Encontrar nomes que est√£o no CSV mas n√£o no relat√≥rio
    nomes_faltando = nomes_csv_norm - nomes_infinitepay_norm
    
    print(f"\nüîç RESULTADO DA COMPARA√á√ÉO:")
    print(f"üìä Total no CSV: {len(nomes_csv)}")
    print(f"üìä Total no relat√≥rio: {len(nomes_infinitepay)}")
    print(f"‚ùå Faltando no relat√≥rio: {len(nomes_faltando)}")
    
    if nomes_faltando:
        print(f"\nüìã RESPONS√ÅVEIS QUE EST√ÉO NO CSV MAS N√ÉO NO RELAT√ìRIO:")
        print("=" * 80)
        
        # Converter nomes normalizados de volta para nomes originais
        nomes_faltando_originais = []
        for nome_norm in nomes_faltando:
            for nome_original in nomes_csv:
                if normalizar_nome(nome_original) == nome_norm:
                    nomes_faltando_originais.append(nome_original)
                    break
        
        # Ordenar alfabeticamente
        nomes_faltando_originais.sort()
        
        for i, nome in enumerate(nomes_faltando_originais, 1):
            print(f"{i:2d}. {nome}")
        
        # Salvar em arquivo
        arquivo_saida = "responsaveis_faltando_31agosto.csv"
        with open(arquivo_saida, 'w', newline='', encoding='utf-8') as arquivo:
            writer = csv.writer(arquivo)
            writer.writerow(['Nome'])
            for nome in nomes_faltando_originais:
                writer.writerow([nome])
        
        print(f"\nüíæ Lista salva em: {arquivo_saida}")
        
    else:
        print("\n‚úÖ Todos os respons√°veis do CSV est√£o no relat√≥rio!")
    
    print("\n" + "=" * 60)

if __name__ == "__main__":
    main() 